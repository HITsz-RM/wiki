# RM2019 工作总结
> 姚智君

- 在2018赛季，我们的机器人终于用上了自瞄，视觉组没有像去年一样白干。从去年队员的总结中看出，去年视觉代码已经实现，但问题在于和电控对接时云台鬼畜，而且去年前提组的进度也比较糟糕，导致视觉组的工作没有发挥作用，实在可惜。

- 今年接手视觉组工作之后，我的首要工作无疑是解决去年遗留下来的对接问题。在与电控对接的过程中，队长发现调整云台pid参数可以使云台正确响应，因此对接的问题算是解决了。但问题在于，这样的话云台虽然能响应，但响应速度较慢，而且跟踪移动目标的时候会存在一定的落后于目标的现象。这个时候，我们认为需要对目标运动进行预测。因此，我找了各种书以及论文，从二次插值、匀速、匀加速模型、卡尔曼滤波到当前统计模型，甚至参考了网上一个比较骚的操作，将卡尔曼的数据反用，然而多种方法弄下来都不能很好解决问题，甚至在跟踪的过程有时还会产生较大抖动。当时和威海的同学交流之后认为可能是摄像头存在一个延迟，测试方法是用摄像头和手机同时拍秒表的画面。这个测试发现我们的摄像头有100ms左右的“延迟”，于是我打算换好一点的工业相机试下，顺便去找ICRA组的学长学姐请教一下。在ICRA组那边交流发现，我们测出的“延迟”只是显示器输出的延迟，而解决跟踪落后于目标的情况，可以在上层加一套PID，通过增大i来消除静差。于是当天下午，我回去现场学了一下PID，并开了个branch，把PID算法融合进视觉代码中。测试发现，这个办法完美解决了问题。通过加入上层PID，就无需修改原来云台的PID参数，从而保持较高的响应速度，同时可以增大i来消除落后的情况，这个可以算得上重大更新了。从此我们的车具有了击打移动目标的能力，在场地测试以及适应性训练的时候，我们打自己的哨兵以及华侨大学的哨兵，都有着较高的命中率。这也使得我在忽略了哨兵机械结构限制的情况下建议加大哨兵底盘移动速度，导致了正式比赛第一场哨兵因跑太快，从动轮的轴脱离而导致哨兵被罚下，进而让我们队失去了出线的机会，这个我有责任。  

- 关于今年的大风车能量机关，我在寒假刚开始留校的那段时间自闭了几个下午，把识别算法以及控制逻辑写了出来，并用模拟的视频进行测试。经过后续几次小修改，大风车的代码在逻辑上应该没有问题了，只是由于采用的是粗暴的场地尺寸定位法，而且未进行场地实拍，很多参数都无法完全确定，而且也没有实体模型进行测试，因此这部分代码也只停留在了理论阶段。后续有时间而且规则没改的情况下可以花时间对其进行完善，采用更科学的定位方法，根据情况优化逻辑。

- 再来谈一下自己学习视觉的经历。我去年其实不是战队的成员，只是后期经常过来战队这边围观调车、帮忙捡一下螺丝之类的，只能勉强算是编外成员。当时我是决定2019赛季要加入战队的。当时我是打算搞电控的，不过感觉视觉用c++，自己相对习惯一些，而且感觉视觉调起来没有电控调PID那么烦（然而到了最后还是学调PID了），因此选择了视觉。当时我是5月份才开始接触视觉，从百度搜索计算机视觉、机器视觉，到了解OpenCV，搭建环境（感受了windows+visual studio, cmake, build的酸爽），之后还花了十几块钱买了100G的视频教程（后来才发现原来有怎么大）。我主要是跟着教程学了一下图像处理（尝试理解背后的数学原理），然后开始上目标跟踪，用各种跟踪方法，尝试跟踪各种物体，之后还自己尝试写了一个跟踪装甲板的算法（非常low）。在学以及做小项目的过程中，其实会发现，课上讲的到实际运用还差了一定距离，而且一些函数的用法还是需要另外查。因此，遇到不懂的函数，我就从百度、CSDN、官方文档去慢慢找，然后自己理解（然后发现还是官方英文的文档讲得准确而且清楚，一些翻译不能体现出英文那种意思）。就这样，我就从零开始，入了视觉的坑。（其实去年培训的内容是我10-1放假时候每天整天看视频现学现卖的）至于队里视觉代码，我差不多是根据程序的流程来看，基本看完了整份大概2000到3000行的代码，并且在一定时间的调试中也基本了解哪部分是干什么的。今年的代码也因为在调试时遇到的各种不人性化的问题，进行了一番改造，将可能经常要改的变量全都扔进xml，避免每次修改都要重新编译，浪费时间；另外将引用文件的地址由绝对地址改为相对地址，避免在将代码拿到其他电脑调的时候还要改一堆东西；还有就是把测试摄像头做成一个独立的程序（同一个project，不同executable），再添加拍照功能并整合了相应的标定程序。

- 经过一年的历练，我从完全不懂视觉，变得具有一定研发和调试视觉代码能力。总的来说，就是学的时候一定要自己动手去做，无论是编译OpenCV源代码，搭建环境，还是跟踪视频敲代码，都要动手做一下，这样才能保留印象；还有就是遇到不懂的时候要多思考、多问，问其他会的人，问百度、CSDN、官方文档，甚至是书籍、论文。希望下一界视觉组成员能够在学习时脚踏实地，在研发时追求创新，让我们的机器人变得更强。最后祝战队来年取得更好的成绩。

- <font size=1>（文笔不好，语句可能不太通顺，望见谅）</font>
