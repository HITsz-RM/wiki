# RM2019 工作总结
> 刘文熠

首先，我想说，今年很不甘心，很难受，很痛心。

## 前序：

想想这差不多一年来加入战队的时光，真的很难忘。

刚开始，我就是一个纯小白，啥也不会，选了电控组，啥叫单片机，什么51，stm32，arduino什么的都完全不了解，更别说队长培训时说的那些中断，gpio，定时器……好吧实话说，看到别人都会的样子，而自己却啥也听不懂，当时感觉自己是真的菜。在那段自闭的时光里，我在虚度光阴，一度产生退队的念头。

那段时间，每天打游戏，睡懒觉，课也不想上，上了课也是在白日做梦……总之那段时间为就是条咸鱼。终于有一天，我良心发现，不能这么消极下去了。既然32对新手那么不友好，那就先学arduino吧。于是狠下心来买了一套300多的学习套装，我的蜕变，也由此开始。

## 蜕变：我和Arduino之间的事

那时我记得我已经学完了c语言了，于是乎，上手arduino也变得极其容易，同时也有一些队长教过的单片机的知识。当自己弄出流水灯，呼吸灯，蜂鸣器，红外遥控，超声波数据的时候，我开始渐渐的了解单片机了，尽管都是调用别人已经编写好的库，但是真的感觉学到了好多东西。

而当我自己制作的红外远程灯光遥控，更是我第一次尝试自己写一套代码而且自己调试，让我的代码逻辑得到很大提高。还做了一些其他项目——基于灯光的超声波测距，蜂鸣器放音乐，打地鼠机。

在此，我感觉我特别要感谢路通宇学长！还记得那次创客举办的创客马拉松，路通宇学长把我拉进他们队，然后让我写代码的总体框架（板子是arduino，项目名称叫啥来着？突然忘了，只知道我们队是追光小队）。在这个比赛中，我学会了焊贴片，焊线，手机APP的简单开发，看程序，整合代码，改bug……反正就是我的能力显著提高了，我们的项目也拿了个二等奖，真的很开心。

在此之后，我开始使用arduino单片机自己设计一辆属于自己的步兵车（这个步兵车是很low的，发射机构使用红外线，云台使用2个SG90舵机，云台还是自己用硬纸板拼接的，底盘就是市面上那个几十块的，遥控使用红外）。不过代码那些写了挺多的，后来立项也是搞小车由于零件不够就从上面拆了好多东西，真的难受。

接下来就是立项了。项目是智慧垃圾小车，一开始以为很简单，后来发现我too young too simple！调试过程中遇到了好多问题，代码、逻辑、参数、底层初始化……具体问题有底盘电机不能正常驱动、底盘不能正常原地转向、无法正常循迹、速度无法控制、传感器数据有误等（具体解决办法就不再细说了吧，太多了，有机械、电控、选型之类的问题）。好吧，就是这样了。

## 快速成长：我和stm32之间的事

还记得只在刚开学接触过stm32，那套学习板还给队长后就再也没有碰过32了，一直到队长要求我们到A栋5楼510外面的空地上写代码。

那时，我基本把32的知识全完了，甚至cube，keil软件都又问题（没有f4的固件）。可是在队长细心的指引下，我很快便掌握了大疆DT7遥控器数据的接收（尽管当时还不太会中断及通信协议，抄就行了）。很快的，在细细研读代码及百度后，我开始慢慢了解啥叫波特率、停止位、校验位了。

接下来队长讲的PID，我也比较快的入手，尽管自闭期间没干啥事，不过我那段时间却看了很多PID的文章，也就很快的入手（现在想起来，当时的PID不是白看的）。接下来由于我物理较好，一眼就明白了麦克纳姆轮的运动原理——力的合成分解（说实话，麦轮真的帅！）然后大脑中也模拟出了轮子的转动。然后，我就能写出遥控步兵车的代码了！当时的我是激动的，开心的，贼有成就感！

接下来，就是要感谢带我入门，耐心培训我的队长谢胜了！可以这么说，队长完全就是我的师傅。还记得他让我用stm32的PWM来驱动摩擦轮，当时我只会arduino输出PWM的函数analogWrite（）而不会32，而且当时我以为只要调用一个函数即可输出PWM。可是，当队长让我搜索百度，我才发现，PWM远没有我想象中的那么简单。首先使能引脚，开启定时器的PWM波模式，配置时钟树，预分频，周期，寄存器初始值……驱动个摩擦轮，我遇到了很多困难，尽管队长知道如何输出PWM，但他没直接跟我说，而是一步步引导我研究PWM。经过这样一个过程，我发现我对32的研究方法开始有思路了。在接下来队长指引我如何通过好盈电调的反馈得到实际转速并算出子弹初速度，我的能力进一步提高。现在还记得当时自闭的情形呢！再次感谢队长当时的耐心引导，否则，现在的我可能还是个菜鸡，连代码都抄不了。

再后来，就是不断地完善遥控器中断，can通信，步兵代码，调云台，云台与底盘融合，和发射机构融合……

## 我与步兵的故事

记得热身赛前几个星期我才可见一代步兵车的全貌吧！

由于上学期已经学会了底盘及云台控制，于是乎，很快我就上手步兵完整代码。可是，云台调的并不是太好，不过，当队长教会我在线调差和如何看J-scope曲线后，在代码已经写好的情况下现在调云台只需短短几分钟。

但是，步兵作为我们战队的主要战力，仅仅实现基本功能是完全不够的，需要进行暴力测试！由于当时我的步兵主控板使用的是我们硬件组自己焊的板子，云台暴力测试经常疯（甚至没有遥控时也会疯，反正就是各种不稳定）。我很难承认是can发送堵塞的问题，因为当时对can了解不多，可事实如此。看了很多can里面的库，并尝试使用空闲的can发送邮箱，还采用了最暴力的办法——重启can，并重新配置can过滤器。一开始还有效，可是，几天后就不行了！

这个情况一直持续到分区赛前几个星期。终于，我们觉得换用大疆的主控板了！然后，用了是真的爽啊！云台不疯了，云台响应快了，底盘跑的稳了……反正就是整个精气神都不一样了！大疆的东西就是好，当然，最烦的莫过于改线。不过，车不疯了，稳了，让我干什么都行。自从换用了官方板，以前的很多问题开始迎刃而解。

后来，我当了步兵4号操作手。

场地适应性训练打华侨大学，我的图传延迟3秒还掉帧，可是说我就是瞎子，啥也看不见，也是也动不了。

第一场打南华大学，第一局太多意外了吧！哨兵被罚下场了我们操作手们居然不知道，步兵3号遥控不了，步兵4号由于我操作失误早早超功率阵亡（看回放感觉有点问题，没怎么动怎么突然就超功率死了？）。第二局好了一点，哨兵上场了，步兵3号依旧掉线，可是，有我和立康打对面够了。尽管数量不及对方，可是凭借我们战车的优越性能我们扳回一局。

第二场打北部湾大学，我们赛前都知道，必须两局都把北部湾打爆我们才能赢。可是第一局我们两辆步兵没把对面哨兵拆了，当然，有对面防守严密的原因，更主要是我们自己的失误。虽然第一局居然没把对面打爆，而且又出现遥控器遥控不了步兵4号的情况，好在只是线烧断了，我们换了根线，发现拨弹盘不转，赛后回想才发现原来是遥控器没升级的原因。虽然第二局我们拆掉了对面哨兵，也打爆了对面基地，但是，我们还是遗憾的淘汰了。不过说实话，第二局打的是真爽！

好了，就写到这吧。

哦，对了，如果想要看关于步兵电控技术方面的，可以找我要技术文档。
